<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>VESSA News Highlights</title>
  <link rel="stylesheet" href="style.css"/>
</head>
<body>
  <div class="container">
    <img src="hero.png" alt="Hero Image" class="hero-image"/>

    <div class="title">üìä Today‚Äôs High-Impact News</div>

    <div id="news" class="news-section">
      <p>Loading news from Forex Factory...</p>
    </div>

    <a href="https://t.me/vpasspro_bot" class="back-button">‚¨ÖÔ∏è Back to VESSA BOT</a>

    <img src="logo.png" alt="Logo" class="footer-logo"/>
  </div>

  <script>
    async function fetchNews() {
      const proxyUrl = "https://api.allorigins.win/get?url=";
      const targetUrl = encodeURIComponent("https://www.forexfactory.com/calendar");

      try {
        const response = await fetch(proxyUrl + targetUrl);
        const data = await response.json();
        const parser = new DOMParser();
        const doc = parser.parseFromString(data.contents, "text/html");

        const newsRows = [...doc.querySelectorAll("#calendar__table .calendar__row")];
        const today = new Date().toISOString().split("T")[0];

        const redNews = newsRows.filter(row => {
          const impact = row.querySelector(".calendar__impact .impact--high");
          const dateAttr = row.getAttribute("data-event-timestamp");
          return impact && dateAttr && new Date(parseInt(dateAttr) * 1000).toISOString().startsWith(today);
        });

        const newsSection = document.getElementById("news");
        newsSection.innerHTML = "";

        if (redNews.length === 0) {
          newsSection.innerHTML = "<p>‚úÖ No high-impact news today!</p>";
        } else {
          redNews.forEach(row => {
            const time = row.querySelector(".calendar__time")?.textContent.trim() || "";
            const currency = row.querySelector(".calendar__currency")?.textContent.trim() || "";
            const event = row.querySelector(".calendar__event")?.textContent.trim() || "";

            const card = document.createElement("div");
            card.classList.add("news-card");
            card.innerHTML = `<strong>${time}</strong> - <span>${currency}</span> <br>${event}`;
            newsSection.appendChild(card);
          });
        }
      } catch (error) {
        document.getElementById("news").innerHTML = "<p>‚ö†Ô∏è Failed to load news. Please try again later.</p>";
        console.error("Error fetching news:", error);
      }
    }

    fetchNews();
  </script>
</body>
</html>
